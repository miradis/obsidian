## Данные в системе 

- собранная информация из база данных

## Показатели

1. Кол-во дней до подписания первого договора с момента регистрации по каждой компании

1.1 Запрос и пояснение запроса: 

1.2 Информация, которая должно возвращаться

  

|   |   |   |   |   |   |   |   |   |   |   |   |
|---|---|---|---|---|---|---|---|---|---|---|---|
|Действия|Подписи|Использованные подписи|Тариф|Тариф до|Кол-во дней до подписания|Наименование|Директор|Телефон|Деятельность|БИН|Дата добавления|

  

2. ### Кол-во подписываемых договоров среднее по дням по компаниям
    

2.1.  Запрос и пояснение запроса: 

2.2.Информация, которая должно возвращаться

3. ### Активность компаний в системе по количеству подписанных договоров ежедневно общее по всем компаниям
    

3.1. Запрос и пояснение запроса:

Цифра:
```
select count (*)

from contract.doc_files df

where df.created_at >= {startDate} and df.created_at <= {endDate}

and df.contract_status !='0' and 
df.company_id not in ('99851767-459f-4b82-bc62-764aa2b3cb19','c7fe068d-e3b3-4876-825e-d23ef7aab0c0', '2ac6791b-5a38-48d4-b239-f52a00dec98f', '2c8d37ba-2f1c-478f-b29c-b755aadc9577')
```


Для графиков
По месяцам
```
select TO_CHAR(df.created_at , 'YYYY-MM') AS date,

count (*)

from contract.doc_files df

where df.created_at >= {startDate} and df.created_at <= {endDate} and 

df.contract_status !='0' and df.company_id not in ('99851767-459f-4b82-bc62-764aa2b3cb19','c7fe068d-e3b3-4876-825e-d23ef7aab0c0', '2ac6791b-5a38-48d4-b239-f52a00dec98f', '2c8d37ba-2f1c-478f-b29c-b755aadc9577')

group by TO_CHAR(df.created_at , 'YYYY-MM')

order by date
```
По дням 
```
select TO_CHAR(df.created_at , 'YYYY-MM-DD') AS date,

count (*)

from contract.doc_files df

where df.created_at >= {startDate} and df.created_at <= {endDate} and 

df.company_id not in ('99851767-459f-4b82-bc62-764aa2b3cb19','c7fe068d-e3b3-4876-825e-d23ef7aab0c0', '2ac6791b-5a38-48d4-b239-f52a00dec98f', '2c8d37ba-2f1c-478f-b29c-b755aadc9577')

df.contract_status !='0'

group by TO_CHAR(df.created_at , 'YYYY-MM-DD')

order by date
```


3.2. Информация, которая должно возвращаться

Талицу с такими данными
По месяцам
date, count
2023-07	12647
2023-08	24268
2023-09	22496
2023-10	22609
2023-11	25550
2023-12	23304
2024-01	26586
2024-02	37021
2024-03	31781
2024-04	16989
По дням
2023-01-03	11
2023-01-04	52
2023-01-05	82
2023-01-06	1093
2023-01-07	70
2023-01-08	39
2023-01-09	398
2023-01-10	234
2023-01-11	233
2023-01-12	212
2023-01-13	118
2023-01-14	44
2023-01-15	28
2023-01-16	217
2023-01-17	218

4. ### Активность компаний в системе по количеству подписанных договоров ежедневно в процессе онбординга
    

4.1. Запрос и пояснение запроса: 

4.2.Информация, которая должно возвращаться


5. ### Активность в системе в процентах ( сколько компаний всего в системе и сколько компаний были активны сегодня)
    

5.1. Запрос и пояснение запроса:

```
WITH MonthlyActiveCompanies AS (

SELECT

DATE_TRUNC('month', df.created_at) AS month,

COUNT(DISTINCT cr.id) AS active_companies

FROM

contract.company_requisites cr

JOIN contract.doc_files df ON cr.id = df.company_id

WHERE

df.contract_status <> '0' AND

df.created_at BETWEEN '2023-01-01' AND '2024-12-01'

GROUP BY

month

),

UniqueCompanies AS (

SELECT

DATE_TRUNC('month', cr.created_at) AS month,

cr.id

FROM

contract.company_requisites cr

WHERE

cr.created_at <= '2024-04-15 23:59:59'

GROUP BY

month, cr.id

),

TotalCompanies AS (

SELECT

month,

COUNT(id) OVER (ORDER BY month) AS total_companies

FROM

UniqueCompanies

)

SELECT

mac.month,

mac.active_companies,

tc.total_companies,

(mac.active_companies::FLOAT / tc.total_companies * 100) AS activity_percentage

FROM

MonthlyActiveCompanies mac

JOIN

TotalCompanies tc ON mac.month = tc.month

ORDER BY

mac.month;
```


5.2.Информация, которая должно возвращаться

  

6. ### Кол-во новых компаний в системе (за период, в среднем) дней


6.1. Запрос и пояснение запроса:
Цифра:
```
select count(*)

from contract.company_requisites cr

where cr.created_at >={startDate} and cr.created_at <= {endDate}
```
Список:

contract_company_requisites_aggregate(where: {created_at: {_lte: "${to}", _gte: "${from}"}}) { aggregate {count} }

  

6.2.Информация, которая должно возвращаться: Число

7. ### Кол-во дней в среднем до подписания первого договора новой компанией с момента регистрации
    

7.1.  Запрос и пояснение запроса:

7.2. Информация, которая должно возвращаться

  

8. ### Кол-во подписываемых договоров среднее по дням
    

8.1. Запрос и пояснение запроса:

8.2. Информация, которая должно возвращаться

  

9. ### Кол-во новых компаний на онбординге по дням
    

9.1. Запрос и пояснение запроса:

9.2. Информация, которая должно возвращаться

  

10. ### Кол-во компаний ежедневно тариф приостановлен 
    

10.1. Запрос и пояснение запроса:

company_tarifs_aggregate( where: {_and: [ { tarif_name: { _eq: "Приостановлен" } }, { is_active: {_eq: "true"} }, { expiration_date : {_gte: "${from}", _lte: "${to}"} }, ]} ) { aggregate { count } }

10.2. Информация, которая должно возвращаться: Количество

  

11. ### Кол-во компаний ежедневно тариф exhausted
    

11.1. Запрос и пояснение запроса:

company_tarifs_aggregate(where: { _and:[ { tarif_name: { _eq: "Exhausted" } }, { is_active: {_eq: "true"} }, { expiration_date : {_gte: "${from}", _lte: "${to}"} }, ]}) { aggregate { count } }

11.2. Информация, которая должно возвращаться

Количество

**